'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.remove = void 0;

var _utils = require("../utils.js");

// -----------------------------------------
// Functions

/**
 * Is it either of the sides?
 *
 * @param {object} opts
 * @param {object} path
 * @param {string} leftKey
 * @param {string} rightKey
 * @returns {object}
 */
const isEitherSide = (opts, path, leftKey = 'left', rightKey = 'right') => {
  const left = path.get(leftKey);
  const right = path.get(rightKey);
  const idsLeft = (0, _utils.getObjItem)(left);
  const idsRight = (0, _utils.getObjItem)(right);
  return {
    isLeft: (0, _utils.matches)(opts, idsLeft.join('.')),
    isRight: (0, _utils.matches)(opts, idsRight.join('.')),
    left,
    right
  };
};
/**
 * Remove var
 *
 * @param {object} t
 * @param {array} opts
 * @param {object} path
 */


const remove = (t, opts = [], path) => {
  if (!path || path.removed) {
    return;
  }

  let toRemove;

  if (path.type === 'VariableDeclarator') {
    const isIt = isEitherSide(opts, path, 'id', 'init');

    if (!isIt.isLeft && !isIt.isRight) {
      return;
    }

    toRemove = path;
  } else if (path.type === 'AssignmentExpression') {
    // We should ignore it for now... It will be checked later
    if (path.get('right').type === 'LogicalExpression') {
      return;
    }

    const isIt = isEitherSide(opts, path);

    if (!isIt.isLeft && !isIt.isRight) {
      return;
    }

    toRemove = path; // To fix a bug with classes

    const parent = toRemove && toRemove.parentPath;

    if (parent && parent.type === 'ConditionalExpression') {
      toRemove = parent;
    }
  } else if (path.type === 'Identifier') {
    const id = (0, _utils.getObjItem)(path).join('.');
    const isIt = (0, _utils.matches)(opts, id);

    if (!isIt) {
      return;
    }

    toRemove = path;
  } else if (path.type === 'MemberExpression') {
    const id = (0, _utils.getObjItem)(path).join('.');
    const isIt = (0, _utils.matches)(opts, id);

    if (!isIt) {
      return;
    }

    toRemove = path;
  } else if (path.type === 'BinaryExpression') {
    const isIt = isEitherSide(opts, path);

    if (!isIt.isLeft && !isIt.isRight) {
      return;
    }

    toRemove = path;
  } else if (path.type === 'LogicalExpression') {
    const isIt = isEitherSide(opts, path);

    if (!isIt.isLeft && !isIt.isRight) {
      return;
    }

    toRemove = isIt.isLeft && isIt.left || isIt.isRight && isIt.right || undefined;
  } // We need to check if it is a IfStatement


  const parent = toRemove && toRemove.parentPath;

  if (parent && parent.type === 'IfStatement') {
    toRemove = parent;
  }

  toRemove && !toRemove.removed && toRemove.remove();
}; // -----------------------------------------
// Export


exports.remove = remove;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tb2R1bGVzL3Zhci5qcyJdLCJuYW1lcyI6WyJpc0VpdGhlclNpZGUiLCJvcHRzIiwicGF0aCIsImxlZnRLZXkiLCJyaWdodEtleSIsImxlZnQiLCJnZXQiLCJyaWdodCIsImlkc0xlZnQiLCJpZHNSaWdodCIsImlzTGVmdCIsImpvaW4iLCJpc1JpZ2h0IiwicmVtb3ZlIiwidCIsInJlbW92ZWQiLCJ0b1JlbW92ZSIsInR5cGUiLCJpc0l0IiwicGFyZW50IiwicGFyZW50UGF0aCIsImlkIiwidW5kZWZpbmVkIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7OztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7Ozs7Ozs7OztBQVNBLE1BQU1BLFlBQVksR0FBRyxDQUFDQyxJQUFELEVBQU9DLElBQVAsRUFBYUMsT0FBTyxHQUFHLE1BQXZCLEVBQStCQyxRQUFRLEdBQUcsT0FBMUMsS0FBc0Q7QUFDdkUsUUFBTUMsSUFBSSxHQUFHSCxJQUFJLENBQUNJLEdBQUwsQ0FBU0gsT0FBVCxDQUFiO0FBQ0EsUUFBTUksS0FBSyxHQUFHTCxJQUFJLENBQUNJLEdBQUwsQ0FBU0YsUUFBVCxDQUFkO0FBQ0EsUUFBTUksT0FBTyxHQUFHLHVCQUFXSCxJQUFYLENBQWhCO0FBQ0EsUUFBTUksUUFBUSxHQUFHLHVCQUFXRixLQUFYLENBQWpCO0FBRUEsU0FBTztBQUNIRyxJQUFBQSxNQUFNLEVBQUUsb0JBQVFULElBQVIsRUFBY08sT0FBTyxDQUFDRyxJQUFSLENBQWEsR0FBYixDQUFkLENBREw7QUFFSEMsSUFBQUEsT0FBTyxFQUFFLG9CQUFRWCxJQUFSLEVBQWNRLFFBQVEsQ0FBQ0UsSUFBVCxDQUFjLEdBQWQsQ0FBZCxDQUZOO0FBR0hOLElBQUFBLElBSEc7QUFHR0UsSUFBQUE7QUFISCxHQUFQO0FBS0gsQ0FYRDtBQWFBOzs7Ozs7Ozs7QUFPQSxNQUFNTSxNQUFNLEdBQUcsQ0FBQ0MsQ0FBRCxFQUFJYixJQUFJLEdBQUcsRUFBWCxFQUFlQyxJQUFmLEtBQXdCO0FBQ25D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Qzs7O0FBQ0EsUUFBTUgsTUFBTSxHQUFHSCxRQUFRLElBQUlBLFFBQVEsQ0FBQ0ksVUFBcEM7O0FBQ0EsTUFBSUQsTUFBTSxJQUFJQSxNQUFNLENBQUNGLElBQVAsS0FBZ0IsYUFBOUIsRUFBNkM7QUFDekNELElBQUFBLFFBQVEsR0FBR0csTUFBWDtBQUNIOztBQUVESCxFQUFBQSxRQUFRLElBQUksQ0FBQ0EsUUFBUSxDQUFDRCxPQUF0QixJQUFpQ0MsUUFBUSxDQUFDSCxNQUFULEVBQWpDO0FBQ0gsQ0E3REQsQyxDQStEQTtBQUNBIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxuaW1wb3J0IHsgZ2V0T2JqSXRlbSwgbWF0Y2hlcyB9IGZyb20gJy4uL3V0aWxzLmpzJztcclxuXHJcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbi8vIEZ1bmN0aW9uc1xyXG5cclxuLyoqXHJcbiAqIElzIGl0IGVpdGhlciBvZiB0aGUgc2lkZXM/XHJcbiAqXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBvcHRzXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBwYXRoXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBsZWZ0S2V5XHJcbiAqIEBwYXJhbSB7c3RyaW5nfSByaWdodEtleVxyXG4gKiBAcmV0dXJucyB7b2JqZWN0fVxyXG4gKi9cclxuY29uc3QgaXNFaXRoZXJTaWRlID0gKG9wdHMsIHBhdGgsIGxlZnRLZXkgPSAnbGVmdCcsIHJpZ2h0S2V5ID0gJ3JpZ2h0JykgPT4ge1xyXG4gICAgY29uc3QgbGVmdCA9IHBhdGguZ2V0KGxlZnRLZXkpO1xyXG4gICAgY29uc3QgcmlnaHQgPSBwYXRoLmdldChyaWdodEtleSk7XHJcbiAgICBjb25zdCBpZHNMZWZ0ID0gZ2V0T2JqSXRlbShsZWZ0KTtcclxuICAgIGNvbnN0IGlkc1JpZ2h0ID0gZ2V0T2JqSXRlbShyaWdodCk7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBpc0xlZnQ6IG1hdGNoZXMob3B0cywgaWRzTGVmdC5qb2luKCcuJykpLFxyXG4gICAgICAgIGlzUmlnaHQ6IG1hdGNoZXMob3B0cywgaWRzUmlnaHQuam9pbignLicpKSxcclxuICAgICAgICBsZWZ0LCByaWdodFxyXG4gICAgfTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBSZW1vdmUgdmFyXHJcbiAqXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSB0XHJcbiAqIEBwYXJhbSB7YXJyYXl9IG9wdHNcclxuICogQHBhcmFtIHtvYmplY3R9IHBhdGhcclxuICovXHJcbmNvbnN0IHJlbW92ZSA9ICh0LCBvcHRzID0gW10sIHBhdGgpID0+IHtcclxuICAgIGlmICghcGF0aCB8fCBwYXRoLnJlbW92ZWQpIHsgcmV0dXJuOyB9XHJcblxyXG4gICAgbGV0IHRvUmVtb3ZlO1xyXG5cclxuICAgIGlmIChwYXRoLnR5cGUgPT09ICdWYXJpYWJsZURlY2xhcmF0b3InKSB7XHJcbiAgICAgICAgY29uc3QgaXNJdCA9IGlzRWl0aGVyU2lkZShvcHRzLCBwYXRoLCAnaWQnLCAnaW5pdCcpO1xyXG4gICAgICAgIGlmICghaXNJdC5pc0xlZnQgJiYgIWlzSXQuaXNSaWdodCkgeyByZXR1cm47IH1cclxuXHJcbiAgICAgICAgdG9SZW1vdmUgPSBwYXRoO1xyXG4gICAgfSBlbHNlIGlmIChwYXRoLnR5cGUgPT09ICdBc3NpZ25tZW50RXhwcmVzc2lvbicpIHtcclxuICAgICAgICAvLyBXZSBzaG91bGQgaWdub3JlIGl0IGZvciBub3cuLi4gSXQgd2lsbCBiZSBjaGVja2VkIGxhdGVyXHJcbiAgICAgICAgaWYgKHBhdGguZ2V0KCdyaWdodCcpLnR5cGUgPT09ICdMb2dpY2FsRXhwcmVzc2lvbicpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgaXNJdCA9IGlzRWl0aGVyU2lkZShvcHRzLCBwYXRoKTtcclxuICAgICAgICBpZiAoIWlzSXQuaXNMZWZ0ICYmICFpc0l0LmlzUmlnaHQpIHsgcmV0dXJuOyB9XHJcblxyXG4gICAgICAgIHRvUmVtb3ZlID0gcGF0aDtcclxuXHJcbiAgICAgICAgLy8gVG8gZml4IGEgYnVnIHdpdGggY2xhc3Nlc1xyXG4gICAgICAgIGNvbnN0IHBhcmVudCA9IHRvUmVtb3ZlICYmIHRvUmVtb3ZlLnBhcmVudFBhdGg7XHJcbiAgICAgICAgaWYgKHBhcmVudCAmJiBwYXJlbnQudHlwZSA9PT0gJ0NvbmRpdGlvbmFsRXhwcmVzc2lvbicpIHtcclxuICAgICAgICAgICAgdG9SZW1vdmUgPSBwYXJlbnQ7XHJcbiAgICAgICAgfVxyXG4gICAgfSBlbHNlIGlmIChwYXRoLnR5cGUgPT09ICdJZGVudGlmaWVyJykge1xyXG4gICAgICAgIGNvbnN0IGlkID0gZ2V0T2JqSXRlbShwYXRoKS5qb2luKCcuJyk7XHJcbiAgICAgICAgY29uc3QgaXNJdCA9IG1hdGNoZXMob3B0cywgaWQpO1xyXG4gICAgICAgIGlmICghaXNJdCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0b1JlbW92ZSA9IHBhdGg7XHJcbiAgICB9IGVsc2UgaWYgKHBhdGgudHlwZSA9PT0gJ01lbWJlckV4cHJlc3Npb24nKSB7XHJcbiAgICAgICAgY29uc3QgaWQgPSBnZXRPYmpJdGVtKHBhdGgpLmpvaW4oJy4nKTtcclxuICAgICAgICBjb25zdCBpc0l0ID0gbWF0Y2hlcyhvcHRzLCBpZCk7XHJcbiAgICAgICAgaWYgKCFpc0l0KSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRvUmVtb3ZlID0gcGF0aDtcclxuICAgIH0gZWxzZSBpZiAocGF0aC50eXBlID09PSAnQmluYXJ5RXhwcmVzc2lvbicpIHtcclxuICAgICAgICBjb25zdCBpc0l0ID0gaXNFaXRoZXJTaWRlKG9wdHMsIHBhdGgpO1xyXG4gICAgICAgIGlmICghaXNJdC5pc0xlZnQgJiYgIWlzSXQuaXNSaWdodCkgeyByZXR1cm47IH1cclxuXHJcbiAgICAgICAgdG9SZW1vdmUgPSBwYXRoO1xyXG4gICAgfSBlbHNlIGlmIChwYXRoLnR5cGUgPT09ICdMb2dpY2FsRXhwcmVzc2lvbicpIHtcclxuICAgICAgICBjb25zdCBpc0l0ID0gaXNFaXRoZXJTaWRlKG9wdHMsIHBhdGgpO1xyXG4gICAgICAgIGlmICghaXNJdC5pc0xlZnQgJiYgIWlzSXQuaXNSaWdodCkgeyByZXR1cm47IH1cclxuXHJcbiAgICAgICAgdG9SZW1vdmUgPSBpc0l0LmlzTGVmdCAmJiBpc0l0LmxlZnQgfHwgaXNJdC5pc1JpZ2h0ICYmIGlzSXQucmlnaHQgfHwgdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFdlIG5lZWQgdG8gY2hlY2sgaWYgaXQgaXMgYSBJZlN0YXRlbWVudFxyXG4gICAgY29uc3QgcGFyZW50ID0gdG9SZW1vdmUgJiYgdG9SZW1vdmUucGFyZW50UGF0aDtcclxuICAgIGlmIChwYXJlbnQgJiYgcGFyZW50LnR5cGUgPT09ICdJZlN0YXRlbWVudCcpIHtcclxuICAgICAgICB0b1JlbW92ZSA9IHBhcmVudDtcclxuICAgIH1cclxuXHJcbiAgICB0b1JlbW92ZSAmJiAhdG9SZW1vdmUucmVtb3ZlZCAmJiB0b1JlbW92ZS5yZW1vdmUoKTtcclxufTtcclxuXHJcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbi8vIEV4cG9ydFxyXG5cclxuZXhwb3J0IHsgcmVtb3ZlIH07XHJcbiJdfQ==